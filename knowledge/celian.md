侧链：Elements（元素链）

作者：知乎用户
链接：https://www.zhihu.com/question/27256432/answer/90574787

侧链的起源侧链（sidechains）实质上不是特指某个区块链，而是指遵守侧链协议的所有区块链，该名词是相对与比特币主链来说的。

侧链协议是指：可以让比特币安全地从比特币主链转移到其他区块链，又可以从其他区块链安全地返回比特币主链的一种协议。

显然，只需符合侧链协议，所有现存的区块链，如以太坊、莱特币、暗网币等竞争区块链都可以成为侧链。元素链（Elements）就是这样一种侧链，所不同的是，它是由Blockstream公司，即侧链协议所提出的公司，所开发的一个侧链的参考实现。

侧链协议具有重大意义，它意味着比特币不仅可以在比特币区块链上流通，还可以在其他区块链上流通，其应用范围和应用前景会更加广泛；有创意的人们会研发出各种各样的应用以侧链协议与比特币主链对接，使得比特币这种基准自由货币的地位越牢固。

侧链协议的产生有以下几个原因：

（1）应对其他区块链的创新威胁以太坊（Ethereum）区块链、比特股（Bitshares）区块链后来居上，对比特币区块链产生相当大的威胁，智能合约和各种去中心化应用在以上两个区块链上兴起，受到人们欢迎；而基于比特币的应用则因为开发难度大，项目不多。

（2）比特币核心开发组不欢迎附生链基于比特币区块链也有合约币（Counterparty）、万事达币（Mastercoin）和彩色币（ColoredCoin）等附生链，但是比特币核心开发组并不欢迎，觉得它们降低了比特币区块链的安全性。他们曾经一度把OP_RETURN的数据区减少到40字节，逼迫合约币开发团队改用其他方式在比特币交易中附带数据。

（3）BlockStream商业化考虑2014年7月份以太坊众筹时，获得了价值1.4亿人民币的比特币，还有20%的以太币，开发团队获得了巨大的回报。但是比特币核心开发组并没有因为他们辛勤工作获得可观回报，因而他们成立了BlockStream，拟实现商业化价值。

基于以上三个原因，提出侧链协议、把比特币转出比特币区块链、另行开发二代区块链，这样的选择既能保证比特币区块链的安全，又能应对二代币的冲击，还能针对不同应用场景实现商业化，因而成了BlockStream的必然选择。

作者：知乎用户
链接：https://www.zhihu.com/question/27256432/answer/90574787
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

侧链协议侧链协议的目的是实现双向锚定（Two-way Peg），使得比特币可以在主链和侧链中互转（图）。<img src="https://pic2.zhimg.com/50/f00a72bf58886eb1cd5c0f96a70caa44_hd.jpg" data-rawwidth="1048" data-rawheight="468" class="origin_image zh-lightbox-thumb" width="1048" data-original="https://pic2.zhimg.com/f00a72bf58886eb1cd5c0f96a70caa44_r.jpg">图 比特币主链与侧链关系图双向锚定分为以下几个阶段：（1）发送锁定交易，把比特币锁定在主链上。由比特币持有者操作，发送一个特殊交易，把比特币锁定在区块链上。<img src="https://pic3.zhimg.com/50/3d492cbc3a898cf6e026c004564345b7_hd.jpg" data-rawwidth="612" data-rawheight="636" class="origin_image zh-lightbox-thumb" width="612" data-original="https://pic3.zhimg.com/3d492cbc3a898cf6e026c004564345b7_r.jpg">双向锚定示意图	（2）等待一个确认期确认期的作用是等待锁定交易被更多区块确认，可防止假冒锁定交易和拒绝服务攻击，典型的等待时间是1-2天。	（3）在侧链上赎回比特币确认期结束后，用户在侧链上创建一个交易花掉锁定交易的输出，并且提供一个SPV工作量证明，输出到自己在侧链上的地址中去。该交易称为赎回交易，SPV工作量证明是指赎回交易所在区块的工作量证明。	（4）等待一个竞争期竞争期的作用是防止双花。在此期间（1）赎回交易不会被打包到区块（2）新传输到侧链的比特币不能使用（3）如果有工作量更大的工作证明出现，即该赎回交易包括了比特币主链更大难度的SPV证明，则上一个赎回交易将被替换。竞争期结束后，该赎回交易将被打包到区块中，用户可以使用他的比特币。	从侧链转比特币到主链的过程也是如此，这就是侧链双向锚定协议。——《区块链：从数字货币到信用社会》（中信出版社），以上节选自第三章——“区块链进阶”。


本文译自元素链官网：http://elementsproject.org

正文

侧链是以锚定比特币为基础的新型区块链，就像美金锚定到金条一样。

比特币的在区块链相当在货币体系的黄金地位，因为他是最去中心化、最多分布节点、最公平区块链。

侧链是以融合的方式实现加密货币金融生态的目标，而不是像其它加密货币一样排斥现有的系统。

利用侧链，我们可以轻松的建立各种智能化的金融合约，股票、期货、衍生品等等。

你可以有成千上万个锚定到比特币上的侧链，特性和目的各不相同，所有这些侧链依赖于比特币主区块链保障的弹性和稀缺性。比较著名的比特币侧链是Rootstock和BlockStream推出的元素链。
 
Rootstock是一个基于比特币侧链的开源智能合约平台，他使得比特币拥有了智能合约，基于Rootstock的智能合约能够运行无数应用，为核心比特币网络增加价值和功能。

Rootstock使用一种比特币双向挂钩技术，这种双向挂钩以一种固定的转换率输送或输出Rootstock上的比特币，Rootstock双向挂钩是一种混合驱链和侧链的技术。

更值得关注的是，Rootstock向后兼容以太坊，实现了以太坊虚拟机的一个改进版本，所以以太坊发布的DApps程序能够轻松地在Rootstock上使用，实现比特币级别的安全性和以太坊大量Dapps的复用性，更快的执行性并和比特币发生更强的相互作用。使用Rootstock可以将性能扩展到TPS为300。
 
元素链（Elements）是Blockstream的开源侧链项目，同样使用比特币双向挂钩技术，除了智能合约外，他还给比特币快速带来许多创新技术，包括私密交易、证据分离、相对锁定时间、新操作码、签名覆盖金额等等特性。核心技术框架采用C++语言开发，开源地址为：https://github.com/ElementsProject/elements

元素链是Blockstream的开源侧链项目，给比特币快速带来许多创新技术。

元素链的许多特性已经在技术社区中已经提出过或者已经开发成功的，这些技术可以被任意组合应用到任意侧链中。

在没有承载上千万比特币的区块链中开发的感觉很好，这还是一条产生更多应用的路。

1当前元素链

1.1私密交易

元素链中最具创新意义的特性莫过于私密交易。私密交易中的金额仅由该交易的参与者知道（或者还有指定的可以知道的人），元素链以密码学算法保证不会多花币。

比特币用地址来保证隐私，同时公开交易让别人验证，元素链在保护个人隐私上更进一步。隐私保护非常重要，如果财务隐私保护不好，会对商家和用户产生严重安全和隐私问题。

一些盗币者和诈骗者会重点关注高价值目标，竞争者会知道商家的商业细节，谈判地位会被泄漏。

私密交易最明显的一点是引入了一种新地址类型，称为私密地址，私密地址含了一个盲化因子，比普通比特币地址更长，这种地址在元素链Alpha版本中是默认地址。

1.2证据分离

Alpha版本的交易中，用于证明其合法性的密码学证据（译者按：即签名）从交易中分离。此举完全消除了任何已知形式的交易可塑性的威胁，并且允许有效的区块链剪枝。

在比特币中，交易包含转帐信息（未花费交易集、地址和金额）和用于证明交易合法性的证据（输入签名），对于分离证据来说，交易ID仅由转帐信息生成，区块分别提交到证明数据。有如下好处：

l 比特币已经有一些“正常化交易ID”的建议，更有效更有用的分离证据包含了这些建议。因为正常化交易ID机制在可塑化输入后还要重写所依赖的交易，这样的正常化对高层协议如Lightning来说是必要基础。

l 交易ID不覆盖签名，此举以比BIP62更基础的方式，避免了交易可朔性的所有形式，而后可以安全地使用更大尺寸的多语句智能合同。

l 具有更有效提供SPV证明（用于轻钱包）的潜力，因为签名可以从交易数据中省略而不破坏Merkle树结构。节点无需存贮或验证旧交易签名的潜力，把签名从磁盘中删除，或无需在网络上传输它，以大幅度减少区块链存贮容易和宽带要求。在Alpha版本中，签名数据比比特币签名更占空间，因为它还包含了大段的输出金额证明（译者按：因为使用了私密交易，隐藏了金额，因而要使用密码学证明来防止多花）。

1.3相对锁定时间

对序列号赋予了新的意义，使得已签名交易被确认后，其输入在一段特定时间内保持无效，目的是支持交易替换功能。

比特币每个交易都有个序列号，初始想法是相比低序列号，最高序列号应该最占优势，矿工应该更喜欢它。但这个想法从未真正实现，未完成的比特币相关代码看起来作了以下假设：即使低序列号能带来更多收益，矿工也会更诚实更喜欢高序列号。这个假设被证明很危险，即便常规矿工（利益最大化驱动的矿工）很少打破这个规则，大多数人认为用序列号替换交易没有用处，因为没有手段来加强“诚实”行为。序列号含义改变，在假设矿工利益最大化前提下，使得交易替换机制得到加强。新增一个操作码CHECKSEQUENCEVERIFY用于比特币脚本检查序列号限制。

相对锁定时间与常规锁定时间用途一致，如时间锁定的担保服务等。但所指的“相对”形式在以区块链为媒介的应用将更有意思。举例：双向锚定阶段可描述为以交易开始的一个相对锁定时间条件，该交易声明了提现证据。

1.4Schnorr签名验证

元素链未使用DER编码的基于secp256k1曲线之上的ECDSA签名方案，CHECKSIG操作码和相关操作码使用在同一曲线上的Schnorr签名方案。好处如下：

l 更有效的n/n阀值签名。多个Schnorr签名可以被合成一个签名，该签名对公钥的总和来说是有效的，所以任意大的n/n多签名只需用一个合签名就可以完成，同时可以被一个CHECKSIG操作所验证。

l 更小的签名容量（64字节，而非71-72字节），并且没有DER编码问题。潜在支持批量验证（同时验证32个签名达到最高2倍加速），这需要知道R.y坐标（ECDSA忽略这个参数）和脚本级别，确保所有签名验证错误导致脚本运行错误（比如所有CHECKSIG操作与CHECKSIGVERIFY类似），以便提供更强的安全证明。

l 能证明没有固有的签名可塑性问题。ECDSA有可塑性问题，并且不知道是否存在其他形式的可塑性问题。注意：分离证据使得签名可塑性不会导致交易可塑性。

l 比ECDSA的签名和验证速度为快一点。

1.5新操作码

元素链Alpha版本有几个新脚本操作码，除此之外的操作码比特币都支持。

1.l 被禁用的操作码。比特币以前支持许多操作码，一些操作码在2010年因为安全考虑被禁用，需要硬分叉才能重新启用。其中一些操作码有明显的风险（如无限制的内存使用），但是并非所有被禁用的操作码都有风险。Alpha版本重新启用了一些被禁用但是安全的操作码，如字符串连接和字串操作码，整数位移码和几个位操作码。

2.l DETERMINISTICRANDOM操作码：根据一个种子在一个范围内产生一个随机数。

3.l CHECKSIGFROMSTACK操作码：验证堆栈中对消息的签名，而不是验证对交易本身的签名。

这些新操作码有一些使用场景，包括双花保护债券、彩票、允许1/N多签名的merkle树结构（N成千上万）、概率支付等。

1.6签名覆盖金额

CHECKSIG操作码验证的签名已经覆盖交易的输出金额，避免使用硬件签名设备来获得以前的交易内容，如果有人伪造输入，生成的签名无论如何都是无效的。

这个改变的另一个影响是签名时需要知道输入金额（无论使不使用盲签名）。

1.7确定性锚定

确定性锚定使得元素链Alpha版本可以承载测试网络的测试币，而无需对测试网络进行任何改变。向Alpha版本发送测试币时，由所有完全节点验证，也可以用RPC调用让测试网络节点来验证区块链关系，而无需压缩的测试网络SPV证明。从Alpha版本发送测试币到测试网络是通过官方人员联合会进行的，他们被暂时信任以保存Alpha版本的测试币（译者按：由某些人掌握所有币并且向测试网络发送币，这听起来不是什么好主意，不过现在只是测试币，他们也表示这只是过渡方法，一旦运行成熟并且在比特币主链上运行时，只需脚本，无需人来掌握和参与，下文有提到）。

侧链，类似于其他竞争链，以联合挖矿保证安全性。然而在一个新区块链刚开始的阶段，除非一开始就有许多矿池采用了联合挖矿，否则会有一个低算力的阶段。在早期低算力阶段，可能会面临安全风险甚至是算力攻击。鉴于同步分散的比特币算力的难度，我们需要一个机制来安全引导元素链。我们在这个Alpha版本中以官方人员确认作为手段，并且正计划下一个版本引入联合挖矿。

1.7签名区块

SHA256d工作证明机制被脚本系统替换，只签名区块而非交易。换句话说，动态成员多方签名（DMMS）被静态成员多方签名所替换。这在以前被称为“私链”。

http://freico.in/docs/freimarkets.pdf 。

元素链Alpha版本使用有门限的官方人员作为协议接口，同时对交易所在区块签名。下个版本将用联合挖矿替换区块签名，尽管官方人员会继续把传输交易通知给主链。签名区块能让交易过程正常进行，直到联合挖矿实施。我们的意图是最终以完全去中心化的双向锚定机制替换官方人员机制。

2建议的元素链

以下是无素链正在开发的一些特性，但还未能提供测试。

2.1基本资产发布

用户可以发行自己的资产，表示基本资产类型如比特币的所有权转移过程，理论上能发行任何资产，如凭证、优惠券、货币、存款、债券、股票等等（根据辖区的监管要求而变化）。

这就为创建无需信任的交易所、期权和其他高级智能合约开辟了道路，这些智能合约可以包含任何资产和“主链币（hostcoin）”(一种内在资产,其ID等于创世块的HASH或者区块链ID；在Alpha中是指由测试币支撑的联合会锚定货币，参见“确定性锚定”部分）。

所有输出以资产识别码来标识，Alpha版本修改了共识规则以便每个资产的输入和输出分别检查。引入了一个新的交易类型用于创建发行资产（称为资产定义交易）。与coinbase交易类似，资产定义交易有一个空输入，与coinbase交易不同的是资产定义交易除空输入外，还有更多的输入项。这个差异不仅帮助我们区分两种交易，而且还确保了资产ID（交易的SHA256d哈希值）的来源。在一个资产定义交易中，以0为资产ID的任意数量的输出可以包含任意输出金额，它们会被认为是新发行资产的初始未花费输出。

这种技术在许多方面与彩色币类似，但是明确且共享加强的标识有如下好处：

1.l 更有效地支持SPV钱包；

2.l 允许更复杂的智能合约；

3.l 从其他智能合约中获利（如：在Alpha上私密交易和彩色币不兼容）

4.l 为更智能的合约开启了道路，这些智能合约依赖区块链，可以操作更多资产。

当前只有主链币可以用于支付费用，但是应该可以用其他资产来支付费用。第一个发布版本中，所有资产都必须在资产定义交易中发行。未来版本允许在资产定义交易之后动态增加数量，允许发行者创建新资产。未来版本还会实现应用于P2P借贷的利息，以及带滞挪金（负利息）的发行资产。

2.1掩模签名哈希模式

新操作码CHECKSIG2允许任意的、矿工可写的输入输出掩模，用于建立更复杂的合约化预承诺场景，比如在一个分布式资产交易所中，某人对自己的买卖请求签名，预先承诺买卖价格和买卖数量。

3测试网络侧链演示：元素链Alpha版本

为了让社区更容易测试元素链，本项目把最优秀的思想融合到正在开发的侧链。第一发布版本是元素链Alpha版本，一个为开发者测试的侧链和网络，其中引入了几种侧链技术，并且锚定到比特币测试链。与比特币一样，所有代码开源。我们正在为侧链努力，并且鼓励其他开发人员向本项目作出贡献。

元素链Alpha旨在实现技术演示并且提供测试环境，目前建议的元素链还未开发完成，作为一个测试网络的开发中的侧链，本链将短期存在，并且有可能被其他技术取代。

元素链Alpha是比特币测试链的一个侧链，尽管当前的锚定机制正如侧链白皮书附录A中所说，是通过中心化协议接口实现的。它依赖可审计的联合签名者来管理传输到侧链的测试币（参见确定性锚定特性），并且以此来产生签名区块（参见签名区块特性）。这样的做法能快速探索侧链实施的可能性，考虑如何使用不同的安全措施。我们计划在未来版本中，升级协议接口以完全支持去中心化的侧链联合挖矿，最终达到完全双向锚定的目标。
