央行选择了pbft算法，简单介绍下区块链常见的几种算法

1、Pow工作量证明，就是大家熟悉的挖矿，通过与或运算，计算出一个满足规则的随机数，即获得本次记账权，发出本轮需要记录的数据，全网其它节点验证后一起存储； 优点：完全去中心化，节点自由进出； 缺点：目前bitcoin已经吸引全球大部分的算力，其它再用Pow共识机制的区块链应用很难获得相同的算力来保障自身的安全；挖矿造成大量的资源浪费；共识达成的周期较长，不适合商业应用
应用案例：比特币

1、Pos权益证明，Pow的一种升级共识机制；根据每个节点所占代币的比例和时间；等比例的降低挖矿难度，从而加快找随机数的速度。 优点：在一定程度上缩短了共识达成的时间 缺点：还是需要挖矿，本质上没有解决商业应用的痛点
应用案例：未来币，以太坊采用了Pow+POS的混合机制。

3、DPos股份授权证明机制，类似于董事会投票，持币者投出一定数量的节点，代理他们进行验证和记账。 优点：大幅缩小参与验证和记账节点的数量，可以达到秒级的共识验证 缺点：整个共识机制还是依赖于代币，很多商业应用是不需要代币存在的
应用案例：比特股

4、pbft拜占庭容错算法，这是一种基于消息传递的一致性算法，算法经过三个阶段达成一致性，这些阶段可能因为失败而重复进行。

假设节点总数为3f+1，f为拜赞庭错误节点：

1、当节点发现leader作恶时，通过算法选举其他的replica为leader。

2、leader通过pre-prepare 消息把它选择的 value广播给其他replica节点，其他的replica节点如果接受则发送 prepare，如果失败则不发送。

3、一旦2f个节点接受prepare消息，则节点发送commit消息。

4、当2f+1个节点接受commit消息后，代表该value值被确定

4个节点，0为leader，同时节点3为fault节点，该节点不响应和发出任何消息。最终节点状态达到commited时，表示该轮共识成功达成。

![1](../pictrue/pbft.jpg)

consensus的效率至少有两方面，一是确认时间，一是scalability--网络节点数乃至dynamics。

PBFT在permissioned setting确认时间不错，然而他的communication至少是节点平方，obviously很难支持大规模网络节点，即使是在permissioned setting。

据试验，hyperledger上一百个节点目前就要到极限。

在区块链中，相较于传统的pow等，pbft这种通过投票来达成共识的机制可以很好的解决包括分叉等问题的同时提升效率。

但这仅仅比较适合于联盟链私有链，因为pbft的机制要求是一个封闭的集群，两两节点需要进行通信，通信量是O(n^2)（通过优化可以减少通信量），在公有链这种全球性的大环境下，既不符合封闭性的原则，同样无法达成这种巨大的通信量。

现阶段我观察大部分创业公司采用的也基本上是联盟链私有链，节点数量并不是很多，采用pbft效率更高结果也更好。


5 SBFT（Simplified Byzantine Fault Tolerance，简化拜占庭容错)

1.首先一个block Generator提交一个加入block的交易请求；

2.其他 block Signers认可（ratify），并且签名；

3.其他的networkmembers在有足够signers数量的条件下，接受block的交易请求；

4.生成新的block；

交易结束。交易历史不可篡改。

# 总结

BFT共识这个大类和比特币共识目前为止很难说谁好谁坏，因为两个东西没法放在同样的模型里对比。

比特币共识需要大型网络，而BFT算法不能应用于超过100个节点，

接着，比特币共识不需要许可，而BFT算法需要许可（至少需要知道节点的数量和他们对应的公钥），但是这东西几乎在各自对应的应用中，几乎不构成障碍。

所以说，BFT共识和比特币共识目前没有交集，放在区块链的语境下的话，公有链用比特币共识更好，私有链（联盟链）用BFT算法更好。

接着，至于pbft是不是最好的BFT算法，或者说，是不是目前BFT算法里最适合区块链的。不是，对于区块链，有很多更好的算法。

然而因为PBFT已经很好了，而且在实际应用中非常成熟，效果也非常好。所以说，并不是PBFT就一定最好，但是PBFT在目前联盟链的场景中非常够用，而且换了其他的共识算法，效率也提高不到哪去。

所以说，目前来看，公有链目前能够确保安全可靠的，只有POW工作证明。

私有链和联盟链，PBFT不是最好的，但肯定是不差的选择（除非环境特殊，PBFT在网络不稳定的情况下延迟很高，而且如果网络稳定或者有其他的条件，有一些算法效率更高）。

至于对于区块链，BFT算法可扩展性（scalability）差，比特币共识（包括POW，POS权益证明或者别的什么PO…）效率低，都不够好。

之所以目前区块链会分成两种，会有公有链私有链之争，归根结底，就是因为目前的所有共识算法，都不够好。

优点：上述共识算法都脱离不了币的存在，系统的正常运转必须有币的奖励机制，系统的安全性实际上是由系统币的持有者维护保证。当我们区块链系统实际运用到商业应用时，由其承载的资产价值可能远远超出系统发行的币的价值，如果由币的持有者保证系统的安全及稳定性将是不可靠的 。

1）系统运转可以脱离币的存在，pbft算法共识各节点由业务的参与方或者监管方组成，安全性与稳定性由业务相关方保证。

2）共识的时延大约在2~5秒钟，基本达到商用实时处理的要求。

3）共识效率高，可满足高频交易量的需求。

应用：央行的数字货币、布萌区块链。
